---
title: "@qazuor/qzpay-cli"
description: Herramienta CLI para generar proyectos QZPay
---

import { Aside, Badge, LinkCard } from '@astrojs/starlight/components';

# @qazuor/qzpay-cli

<Badge text="Herramientas" variant="caution" />

<LinkCard
  title="Ver en npm"
  href="https://www.npmjs.com/package/@qazuor/qzpay-cli"
  description="@qazuor/qzpay-cli"
/>

Herramienta CLI para generar configuraciones completas de facturación QZPay.

## Instalación

```bash
# Instalación global
pnpm add -g @qazuor/qzpay-cli

# O como dependencia de desarrollo
pnpm add -D @qazuor/qzpay-cli
```

## Comandos

### init

El comando `init` genera una configuración completa de facturación a través de un asistente interactivo:

```bash
# Modo interactivo
pnpm qzpay init

# Especificar directorio de salida
pnpm qzpay init --dir ./src/billing

# Omitir prompts y usar valores predeterminados
pnpm qzpay init --yes
```

#### Qué hace

El asistente te guía a través de:

1. **Información del Proyecto**
   - Nombre del proyecto (kebab-case)
   - Directorio de salida
   - Descripción (opcional)

2. **Selección de Proveedor de Pagos**
   - Stripe
   - MercadoPago
   - Ambos (multi-proveedor)

3. **Adaptador de Almacenamiento**
   - Drizzle + PostgreSQL (recomendado para producción)
   - En memoria (para desarrollo/pruebas)

4. **Integración de Framework**
   - Hono (rápido, ligero)
   - NestJS (empresarial)
   - Solo librería (sin capa HTTP)

5. **Características**
   - Suscripciones (facturación recurrente)
   - Pagos únicos
   - Facturación basada en uso
   - Marketplace (multi-vendedor vía Stripe Connect)
   - Add-ons

6. **Configuración de Planes**
   - Freemium: Free + Pro + Enterprise
   - Por niveles: Basic + Professional + Agency
   - Basado en uso: Starter + Growth + Business + Enterprise
   - Planes personalizados

## Archivos Generados

Según tus selecciones, el CLI genera:

### Archivos Base (Siempre Generados)

| Archivo | Descripción |
|---------|-------------|
| `qzpay.config.ts` | Configuración principal de facturación |
| `.env.example` | Plantilla de variables de entorno |
| `types.ts` | Definiciones de tipos TypeScript |
| `plans.ts` | Script de creación de planes |
| `services.ts` | Servicios de lógica de negocio |

### Archivos Específicos del Framework

**Hono:**
- `routes.ts` - Rutas de API
- `webhooks.ts` - Manejadores de webhooks

**NestJS:**
- `billing.module.ts` - Módulo NestJS
- `billing.service.ts` - Servicio inyectable
- `webhooks.controller.ts` - Controlador de webhooks
- `webhooks.ts` - Manejadores de webhooks

## Configuración Generada

### qzpay.config.ts

```typescript
import { createQZPayBilling } from '@qazuor/qzpay-core';
import { createQZPayStripeAdapter } from '@qazuor/qzpay-stripe';
import { createQZPayDrizzleAdapter } from '@qazuor/qzpay-drizzle';
import { drizzle } from 'drizzle-orm/postgres-js';
import postgres from 'postgres';

// Database connection
const sql = postgres(process.env.DATABASE_URL!);
const db = drizzle(sql);

// Create billing instance
export const billing = createQZPayBilling({
  storage: createQZPayDrizzleAdapter(db),
  paymentAdapter: createQZPayStripeAdapter({
    apiKey: process.env.STRIPE_SECRET_KEY!
  }),
  livemode: process.env.NODE_ENV === 'production'
});

// Event listeners
billing.on('subscription.created', async (event) => {
  console.log('New subscription:', event.data.id);
});

billing.on('payment.succeeded', async (event) => {
  console.log('Payment received:', event.data.amount);
});
```

### .env.example

```bash
# Database
DATABASE_URL=postgresql://user:pass@localhost:5432/billing

# Stripe
STRIPE_SECRET_KEY=sk_test_xxx
STRIPE_WEBHOOK_SECRET=whsec_xxx
STRIPE_PUBLISHABLE_KEY=pk_test_xxx

# MercadoPago (if selected)
MERCADOPAGO_ACCESS_TOKEN=TEST-xxx
MERCADOPAGO_WEBHOOK_SECRET=xxx
MERCADOPAGO_PUBLIC_KEY=TEST-xxx

# Server (if framework selected)
PORT=3000
HOST=localhost
```

### services.ts

```typescript
import { billing } from './qzpay.config';

// Customer management
export async function registerCustomer(email: string, name: string) {
  return billing.customers.create({ email, name });
}

export async function getCustomer(customerId: string) {
  return billing.customers.get(customerId);
}

// Subscription management
export async function subscribeToPlan(customerId: string, planId: string) {
  return billing.subscriptions.create({ customerId, planId });
}

export async function changePlan(subscriptionId: string, newPlanId: string) {
  return billing.subscriptions.changePlan(subscriptionId, { newPlanId });
}

export async function cancelSubscription(subscriptionId: string) {
  return billing.subscriptions.cancel(subscriptionId, { atPeriodEnd: true });
}

// Payment history
export async function getPaymentHistory(customerId: string) {
  return billing.payments.getByCustomerId(customerId);
}

export async function getInvoices(customerId: string) {
  return billing.invoices.getByCustomerId(customerId);
}
```

### plans.ts

Script para crear tus planes en el proveedor de pagos:

```typescript
import Stripe from 'stripe';

const stripe = new Stripe(process.env.STRIPE_SECRET_KEY!);

async function createPlans() {
  // Create Pro plan
  const proProduct = await stripe.products.create({
    name: 'Pro Plan',
    description: 'Professional features'
  });

  const proMonthly = await stripe.prices.create({
    product: proProduct.id,
    unit_amount: 2900, // $29.00
    currency: 'usd',
    recurring: { interval: 'month' }
  });

  const proYearly = await stripe.prices.create({
    product: proProduct.id,
    unit_amount: 29000, // $290.00
    currency: 'usd',
    recurring: { interval: 'year' }
  });

  console.log('Plans created!');
  console.log('Pro Monthly:', proMonthly.id);
  console.log('Pro Yearly:', proYearly.id);
}

createPlans();
```

Ejecutar con: `npx tsx plans.ts`

## Después de la Generación

1. **Copiar variables de entorno:**
   ```bash
   cp .env.example .env
   # Completa con tus credenciales reales
   ```

2. **Instalar dependencias:**
   ```bash
   pnpm install
   ```

3. **Crear planes en el proveedor de pagos:**
   ```bash
   npx tsx plans.ts
   ```

4. **Ejecutar migraciones de base de datos (si usas Drizzle):**
   ```bash
   pnpm drizzle-kit push
   ```

5. **Iniciar tu aplicación:**
   ```bash
   pnpm dev
   ```

## Opciones del CLI

```bash
qzpay init [options]

Options:
  -d, --dir <directory>  Directorio de salida (default: ".")
  -y, --yes              Omitir prompts y usar valores predeterminados
  -h, --help             Mostrar ayuda
```

<Aside type="note">
El CLI es una herramienta de generación que crea archivos de proyecto. No incluye comandos en tiempo de ejecución para gestionar clientes, suscripciones o planes. Esas operaciones se realizan programáticamente a través del código generado o mediante la API de QZPay.
</Aside>

<Aside type="tip">
Después de la generación, personaliza los archivos generados para que coincidan con los requisitos específicos de tu negocio. El código generado está pensado como punto de partida.
</Aside>
